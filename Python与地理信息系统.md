# 距离测量

计算距离时有3种地球模型可供选择：

- 平面
- 球体
- 椭球体

**平面模型**

采用标准的欧几里得几何，地球被当作没有曲率的平面。

地理空间坐标系常用的格式时十进制度数，但是十进制度数坐标是分别根据经纬度和本初子午线、维度线和赤道在地球模型上形成的角度获取的。 此外经度在两极向零度收敛，维度线周长在两极也相应变得更小。

地图投影试图将三维球体转换为地图或者计算机屏幕这样的二维平面来简化这一问题。 地图投影是把地球模型压扁转换成二维平面，并且为了方便制作地图，允许部分失真。
投影过后，十进制度数会被当作包含x和y的笛卡尔直角坐标系统来使用，这样方便使用欧氏几何的勾股定理。

**球体模型**

通过避免将地球平铺到一个平面上从而能够更好地表现地球的实际状态。

该模型使用一个完美的球体来表达地球的特征（和地球物理模型类似），它允许你直接进行度数测量， 忽略了一个事实 —— 地球的形状实际是由薄厚不均的地壳组成的像蛋黄一样的椭球体。

**椭球体模型**

在使用椭球体地球模型过程中，分析师一致尝试找到一个最佳的地表模型。 目前存在多种椭球体地球模型基准，其中一套基准就是一组地球形状定义的集合，也被称为大地测量坐标系统。

和其他地理坐标系统类似，基准也可以对特定区域进行优化，最常用的基准是基于全球的WGS84基准。
在东半球，欧洲地面参照系统更流行，ETRS89基准对欧亚大陆板块做了微调，使用ETRS89基准制作的地图不会受到地壳每年高达2.5cm的大陆板块漂移的影响。

椭球体重心到其表面不存在一个固定的半径，虽然不是完全近似，但是它比正圆形球体模型更符合实际。 另外还有一种模型叫大地水平面模型，它是不受除了重力和自转等因素之外影响的最精准的地球模型。

![密西西比州两个城市之间的距离计算](img/密西西比州两个城市之间的距离计算.jpg)

[距离测量.py](<./距离测量.py>)

## 勾股定理(也叫欧氏距离公式) —— 平面地球模型

a^2^ + b^2^ = c^2^

## 半正失公式 —— 球体地球模型

勾股定理中的十进制度数存在投影误差的原因之一是和大圆距离（球面距离）有关。

**大圆距离**是指球体表面上两点之间最短的距离（根据经度纬度计算两点间的距离）。

一般来说，球面上任意两点A和B以及球心都可以确定唯一的大圆，这个大圆被称为**黎曼圆**，而在大圆上连接这两点的较短的一条弧的长度就是大圆距离。

若这两点和球心正好都在球的直径上，则过这三点可以有无数大圆，但两点之间的弧长都相等，因此该大圆能够将球体等分。

![大圆将球体等分](img/大圆将球体等分.jpg)

最佳的十进制度数的距离测量方法 —— **半正失公式**

> 半正矢（haversine）在三角函数中，称1/2(1-cos α)为角α的半正矢，记作hav α，即hav α=1/2(1-cos α)

> 半正矢函数为正矢（versed sine）函数乘以1/2，在三角函数中，称1－cos α为角α的正矢，记作vers α， 即vers α=1-cos α

![半正矢公式](img/半正矢公式.png)

λ：经度 φ：纬度

[半正矢距离计算公式具体推导过程](<https://en.wikipedia.org/wiki/Haversine_formula>)

半正矢公式是最常用的距离计算公式，
因为它相对来说代码量较少并且大部分情况下足够精确，他的精度范围能够控制在1m以内。

> 目前遇到的大部分坐标点都是未经投影变换的十进制度数格式。
> 所以，从距离测量的角度来看，有以下几个可供选择的方案：
> - 重投影到一个精确的笛卡尔坐标系统中进行计算距离
> - 根据精度要求只使用半正失公式
> - 使用精度更高的Vincenty公式

## Vincenty公式 —— 椭球体地球模型

如果使用的是一个本地化的椭球体模型，那么它的计算精度可以远远小于1m，
可以自定义半长轴和扁平率来匹配任何权威的椭球体模型。

[Vincenty公式](<https://en.wikipedia.org/wiki/Vincenty%27s_formulae>)

> [geopy模块](<https://geopy.readthedocs.io/en/latest/>)包含一个Vincenty公式的实现，并且它还支持地理位置编码，能够将地名转换为经纬度坐标。

更进一步了解距离和方位测量知识以及和它们相关的编程算法实现，可以访问[此网址](<http://www.movable-type.co.uk/scripts/latlong.html>)


